{-# LANGUAGE TemplateHaskell #-}
{-# LANGUAGE OverloadedStrings #-}

module Main where

import Gauge

import Binrep
import Binrep.Generic
import Binrep.Put.WithBLen
import Binrep.Type.ByteString
import Refined

import GHC.Generics ( Generic )
import Data.Word

import Foreign

{-
data X = X Word8 Word16 Word8
    deriving stock (Generic)

instance Put X where put = putGeneric c
instance Put' X where put' = put'Generic
instance BLen X where blen _ = 4
-}

data X3
    = X31 Word8
    | X32 Word8
    | X33 Word8 (AsByteString 'C) X3
    deriving stock (Generic)

--instance Put X3 where put = putGeneric cDef
instance Put X3 where put x3 = put'ToMason blen put' x3
instance BLen X3 where blen = blenGeneric cDef

--instance Put' X3 where put' = put'Generic cDef
instance Put' X3 where
    put' x3 p =
        case x3 of
          X31 w8 -> do
            put'CString "X31" p
            put' w8 (p `plusPtr` 4)
          X32 w8 -> do
            put'CString "X32" p
            put' w8 (p `plusPtr` 4)
          X33 w8 bs x3' -> do
            put'CString "X33" p
            put' w8 (p `plusPtr` 4)
            put' bs (p `plusPtr` 5)
            put' x3' (p `plusPtr` (5 + blen bs))

x33 :: X3
x33 =
      X33 001 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X33 002 $$(refineTH "hi, cstring here")
    $ X33 003 $$(refineTH "hi, cstring here")
    $ X33 004 $$(refineTH "hi, cstring here")
    $ X33 005 $$(refineTH "hi, cstring here")
    $ X33 006 $$(refineTH "hi, cstring here")
    $ X33 007 $$(refineTH "hi, cstring here")
    $ X32 008

main :: IO ()
main = defaultMain
  [ bgroup "tiny"
    [ bench "put"  $ whnf Binrep.runPut               x33
    , bench "put'" $ whnf Binrep.Put.WithBLen.runPut' x33
    ]
  ]
